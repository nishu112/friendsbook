{% load static %}
<!DOCTYPE html>
<html lang="en">

<head >
	<title>{% block title %}Friendsbook{% endblock %}</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
	<link rel="stylesheet" href="{% static 'css/home.css' %}" type = "text/css"/>
	<link rel="stylesheet" href="{% static 'css/notification.css' %}" type = "text/css"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css" />

<script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
	{% block head %}

	{% endblock head %}

</head>

<body  style="">

{%include "friendsbook/header.html"%}
<main>
<div class="container-fluid">
{%include "groups/create_groups.html"%}
		{% block content %}
		{% endblock content%}

</div>
</main>


	<script src="{% static 'custom/home.js' %}"></script>
	<script src="{% static 'js/profile/profile.js' %}"></script>
	<script src="{% static 'custom/chatting.js' %}"></script>
	  <script src="{% static 'js/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>
  <script src="{% static 'js/jquery-file-upload/jquery.iframe-transport.js' %}"></script>
  <script src="{% static 'js/jquery-file-upload/jquery.fileupload.js' %}"></script>
  <script src="{% static 'js/js/basic-upload.js' %}"></script>
  <script src="{% static 'custom/messaging.js' %}" type="text/javascript"></script>



  <script>
(function( $ ){
$('[data-toggle="tooltip"]').tooltip();
});
	var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
	var socket = new WebSocket(ws_scheme+'://' + window.location.host + '/users/');
	var socket = new WebSocket(ws_scheme+'://' + window.location.host + '/{{user.username}}/');

    socket.onopen = function open() {

      console.log('WebSockets connection created.');
    };

    socket.onmessage = function message(event) {
    var data = JSON.parse(event.data);
	  var type = data['type'];
	  var user = data['user'];
	  //did this logic to satisfy condition
	  //so that message will recieve only if
	  //we clicked on the link
	  if(type=='online'){
		  var online_user=$('.users-list a div').filter(function(){
		  return $(this).data('username')==user;
		  });
		  var fname=data['fname'];
		  var lname=data['lname'];
		  if(lname){}
		  else lname="";
		  if(data['is_logged_in'])
		  online_user.html('<span style="background: rgb(66, 183, 42); border-radius: 50%; display: inline-block;float:right; height: 6px; margin-left: 4px;float:right;margin-top: 17px; width: 6px;"></span>');
		  else
		  online_user.html('');
		  return;
	  }
	  var text = data['text'];
	  var fuser = data['fuser'];
		if('{{user.username}}'!=user)
	  	{

			$('#msg-list').append('<span data-placement="right" data-toggle="tooltip" title="'+data['time']+'"> <p class="text-left list-group-item">' +data['text'] + '</p></span>')

		  $('#msg-list').scrollTop(document.getElementById("msg-list").scrollHeight);
			}


    };
    if (socket.readyState == WebSocket.OPEN) {
      socket.onopen();
    }

	
  </script>

	  {% block javascript %}
		{% endblock  %}


</body>

</html>
